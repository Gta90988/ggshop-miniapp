<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GGshop - –ú–∞–≥–∞–∑–∏–Ω –∏–≥—Ä</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary-color: #8a2be2;
            --secondary-color: #6a0dad;
            --accent-color: #9370db;
            --background-color: #f5f5f5;
            --card-color: #ffffff;
            --text-color: #333333;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 100%;
            padding: 20px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .card {
            background: var(--card-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .card-content {
            margin-bottom: 15px;
        }

        .button {
            display: inline-block;
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s ease;
            text-align: center;
            width: 100%;
            margin: 5px 0;
        }

        .button:hover {
            background: var(--secondary-color);
        }

        .button-secondary {
            background: var(--accent-color);
        }

        .button-success {
            background: var(--success-color);
        }

        .button-warning {
            background: var(--warning-color);
            color: #000;
        }

        .button-danger {
            background: var(--danger-color);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .balance-display {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            color: var(--primary-color);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .price-tag {
            font-size: 20px;
            font-weight: bold;
            color: var(--success-color);
            margin: 10px 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 12px;
            max-width: 500px;
            position: relative;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 24px;
            cursor: pointer;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--success-color);
            color: white;
            border-radius: 8px;
            z-index: 1001;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ GGshop</h1>
            <p>–õ—É—á—à–∏–π –º–∞–≥–∞–∑–∏–Ω –∏–≥—Ä –≤ Telegram</p>
        </div>

        <div id="main-menu" class="tab-content active">
            <div class="grid">
                <div class="card">
                    <h3 class="card-title">üõí –ú–∞–≥–∞–∑–∏–Ω</h3>
                    <p class="card-content">–ò–≥—Ä—ã –ø–æ –≤—ã–≥–æ–¥–Ω—ã–º —Ü–µ–Ω–∞–º —Å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–æ–π</p>
                    <button class="button" onclick="showTab('shop')">–ü–µ—Ä–µ–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω</button>
                </div>

                <div class="card">
                    <h3 class="card-title">üè™ –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</h3>
                    <p class="card-content">–ü–æ–∫—É–ø–∞–π—Ç–µ –∏ –ø—Ä–æ–¥–∞–≤–∞–π—Ç–µ –∏–≥—Ä—ã —É –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                    <button class="button" onclick="showTab('marketplace')">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</button>
                </div>

                <div class="card">
                    <h3 class="card-title">üí∞ –ë–∞–ª–∞–Ω—Å</h3>
                    <p class="card-content">–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –∏ —Å–æ–≤–µ—Ä—à–∞–π—Ç–µ –ø–æ–∫—É–ø–∫–∏</p>
                    <button class="button" onclick="showTab('balance')">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º</button>
                </div>

                <div class="card">
                    <h3 class="card-title">üë§ –ü—Ä–æ—Ñ–∏–ª—å</h3>
                    <p class="card-content">–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</p>
                    <button class="button" onclick="showTab('profile')">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</button>
                </div>
            </div>
        </div>

        <div id="shop" class="tab-content">
            <h2>üõí –ú–∞–≥–∞–∑–∏–Ω –∏–≥—Ä</h2>
            <div id="shop-content"></div>
            <button class="button" onclick="showTab('main-menu')">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="marketplace" class="tab-content">
            <h2>üè™ –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</h2>
            <div id="marketplace-content"></div>
            <button class="button" onclick="showCreateListing()">üì¢ –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</button>
            <button class="button" onclick="showTab('main-menu')">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="balance" class="tab-content">
            <h2>üí∞ –ë–∞–ª–∞–Ω—Å</h2>
            <div class="balance-display" id="balance-amount">0.00 —Ä—É–±.</div>
            <button class="button button-success" onclick="depositBalance()">‚≠ê –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
            <button class="button" onclick="showTab('main-menu')">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="profile" class="tab-content">
            <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
            <div id="profile-content"></div>
            <button class="button" onclick="showTab('main-menu')">–ù–∞–∑–∞–¥</button>
        </div>

        <div id="create-listing-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('create-listing-modal')">&times;</span>
                <h3>üì¢ –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h3>
                <form id="listing-form">
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã:</label>
                        <input type="text" class="form-input" id="listing-title" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                        <textarea class="form-input" id="listing-description" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–¶–µ–Ω–∞ (—Ä—É–±.):</label>
                        <input type="number" class="form-input" id="listing-price" min="1" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</label>
                        <select class="form-input" id="listing-platform" required>
                            <option value="Steam">Steam</option>
                            <option value="Xbox">Xbox</option>
                            <option value="PS5">PS5</option>
                            <option value="Nintendo">Nintendo Switch</option>
                            <option value="Other">–î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>
                    <button type="submit" class="button button-success">–†–∞–∑–º–µ—Å—Ç–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</button>
                </form>
            </div>
        </div>

        <div id="notification" class="notification"></div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        let user = tg.initDataUnsafe?.user;
        let userData = null;

        tg.expand();
        tg.enableClosingConfirmation();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            if (user) {
                initializeUser();
            } else {
                showError("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω");
            }
        });

        async function initializeUser() {
            try {
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –≤–∞—à–µ–º—É –±—ç–∫–µ–Ω–¥—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                userData = {
                    user_id: user.id,
                    username: user.username,
                    first_name: user.first_name,
                    balance: 100.00, // –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
                    reputation: 5
                };
                
                updateUI();
            } catch (error) {
                showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö");
            }
        }

        function updateUI() {
            if (userData) {
                document.getElementById('balance-amount').textContent = userData.balance.toFixed(2) + ' —Ä—É–±.';
                updateProfileContent();
                loadShopProducts();
                loadMarketplaceListings();
            }
        }

        function updateProfileContent() {
            const profileContent = document.getElementById('profile-content');
            profileContent.innerHTML = `
                <div class="card">
                    <h3>üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <p><strong>–ò–º—è:</strong> ${userData.first_name}</p>
                    <p><strong>Username:</strong> @${userData.username || '–Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                    <p><strong>–ë–∞–ª–∞–Ω—Å:</strong> ${userData.balance.toFixed(2)} —Ä—É–±.</p>
                    <p><strong>–†–µ–ø—É—Ç–∞—Ü–∏—è:</strong> ${userData.reputation} ‚≠ê</p>
                </div>
                <div class="card">
                    <h3>üìä –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</h3>
                    <p>–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –±–æ–Ω—É—Å—ã!</p>
                    <p>–í–∞—à–∞ —Å—Å—ã–ª–∫–∞: <code>https://t.me/GGshopBot?start=ref_${userData.user_id}</code></p>
                </div>
            `;
        }

        async function loadShopProducts() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –º–∞–≥–∞–∑–∏–Ω–∞
            const shopContent = document.getElementById('shop-content');
            shopContent.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</div>';

            try {
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –≤–∞—à–µ–º—É API
                const products = [
                    { id: 1, name: 'Cyberpunk 2077', description: '–ö–ª—é—á –¥–ª—è Steam', price: 1499.00, category: 'Steam' },
                    { id: 2, name: 'FIFA 23', description: '–ö–ª—é—á –¥–ª—è Xbox', price: 1999.00, category: 'Xbox' },
                    { id: 3, name: 'God of War Ragnarok', description: '–ö–ª—é—á –¥–ª—è PS5', price: 2499.00, category: 'PS5' }
                ];

                let html = '<div class="grid">';
                products.forEach(product => {
                    html += `
                        <div class="card">
                            <h3>${product.name}</h3>
                            <p>${product.description}</p>
                            <div class="price-tag">${product.price.toFixed(2)} —Ä—É–±.</div>
                            <button class="button button-success" onclick="buyProduct(${product.id})">–ö—É–ø–∏—Ç—å</button>
                        </div>
                    `;
                });
                html += '</div>';
                shopContent.innerHTML = html;
            } catch (error) {
                shopContent.innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</div>';
            }
        }

        async function loadMarketplaceListings() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞
            const marketplaceContent = document.getElementById('marketplace-content');
            marketplaceContent.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π...</div>';

            try {
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –≤–∞—à–µ–º—É API
                const listings = [
                    { id: 1, title: 'The Witcher 3', description: '–ü–æ–ª–Ω–æ–µ –∏–∑–¥–∞–Ω–∏–µ', price: 899.00, platform: 'Steam' },
                    { id: 2, title: 'Halo Infinite', description: '–¶–∏—Ñ—Ä–æ–≤–∞—è –≤–µ—Ä—Å–∏—è', price: 1599.00, platform: 'Xbox' }
                ];

                let html = '<div class="grid">';
                listings.forEach(listing => {
                    html += `
                        <div class="card">
                            <h3>${listing.title}</h3>
                            <p>${listing.description}</p>
                            <p><strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> ${listing.platform}</p>
                            <div class="price-tag">${listing.price.toFixed(2)} —Ä—É–±.</div>
                            <button class="button" onclick="viewListing(${listing.id})">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</button>
                        </div>
                    `;
                });
                html += '</div>';
                marketplaceContent.innerHTML = html;
            } catch (error) {
                marketplaceContent.innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</div>';
            }
        }

        function showTab(tabId) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabId).classList.add('active');
        }

        function showCreateListing() {
            document.getElementById('create-listing-modal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        async function depositBalance() {
            try {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Telegram
                tg.showPopup({
                    title: '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞',
                    message: '–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è',
                    buttons: [
                        {type: 'default', text: '100 —Ä—É–±–ª–µ–π', id: '100'},
                        {type: 'default', text: '500 —Ä—É–±–ª–µ–π', id: '500'},
                        {type: 'default', text: '1000 —Ä—É–±–ª–µ–π', id: '1000'},
                        {type: 'cancel', id: 'cancel'}
                    ]
                }, function(buttonId) {
                    if (buttonId !== 'cancel') {
                        processPayment(parseInt(buttonId));
                    }
                });
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞');
            }
        }

        async function processPayment(amount) {
            try {
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π Telegram
                showNotification(`–ó–∞–ø—Ä–æ—Å –Ω–∞ –æ–ø–ª–∞—Ç—É ${amount} —Ä—É–±–ª–µ–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω`);
                
                // –ò–º–∏—Ç–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
                setTimeout(() => {
                    userData.balance += amount;
                    updateUI();
                    showNotification(`–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount} —Ä—É–±–ª–µ–π!`);
                }, 2000);
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞');
            }
        }

        function buyProduct(productId) {
            tg.showPopup({
                title: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏',
                message: '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?',
                buttons: [
                    {type: 'default', text: '–ö—É–ø–∏—Ç—å', id: 'buy'},
                    {type: 'cancel', text: '–û—Ç–º–µ–Ω–∞', id: 'cancel'}
                ]
            }, function(buttonId) {
                if (buttonId === 'buy') {
                    completePurchase(productId);
                }
            });
        }

        async function completePurchase(productId) {
            try {
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏
                showNotification('–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!');
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ');
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.backgroundColor = type === 'success' ? 'var(--success-color)' : 'var(--danger-color)';
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function showError(message) {
            showNotification(message, 'error');
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        document.getElementById('listing-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('listing-title').value;
            const description = document.getElementById('listing-description').value;
            const price = parseFloat(document.getElementById('listing-price').value);
            const platform = document.getElementById('listing-platform').value;

            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            console.log('–°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è:', { title, description, price, platform });
            
            showNotification('–û–±—ä—è–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ!');
            closeModal('create-listing-modal');
            
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('listing-form').reset();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
            loadMarketplaceListings();
        });
    </script>
</body>
</html>